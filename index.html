<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Law News Today - Professional Legal News</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <!-- Supabase Client Library -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        .font-playfair { font-family: 'Playfair Display', serif; }
        .news-card { transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .news-card:hover { transform: translateY(-5px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        .ad-placeholder { background-color: #e2e8f0; border: 2px dashed #94a3b8; display: flex; align-items: center; justify-content: center; text-align: center; color: #475569; font-size: 0.875rem; font-weight: 500; border-radius: 0.5rem; }
        .prose { color: #374151; }
        /* Loading Skeleton Style */
        .skeleton { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }
    </style>
</head>
<body class="bg-gray-50">

    <!-- HEADER & NAVIGATION -->
    <header class="bg-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-4">
            <nav class="flex items-center justify-between py-4">
                <a href="#" id="home-link" class="nav-link text-3xl font-playfair font-bold text-gray-800">LawNews</a>
                <div class="hidden md:flex items-center space-x-6">
                    <a href="#" id="home-link-desktop" class="nav-link text-gray-700 font-medium hover:text-blue-700">Home</a>
                    <a href="#" id="sc-link" class="nav-link text-gray-700 font-medium hover:text-blue-700">Supreme Court</a>
                    <a href="#" id="hc-link" class="nav-link text-gray-700 font-medium hover:text-blue-700">High Courts</a>
                    <a href="#" id="columns-link" class="nav-link text-gray-700 font-medium hover:text-blue-700">Columns</a>
                    <a href="#" id="interviews-link" class="nav-link text-gray-700 font-medium hover:text-blue-700">Interviews</a>
                </div>
                <button id="mobile-menu-button" class="md:hidden text-gray-700 text-2xl"><i class="fas fa-bars"></i></button>
            </nav>
        </div>
        <!-- FIX: Re-added the mobile menu container -->
        <div id="mobile-menu" class="hidden md:hidden bg-white border-t border-gray-200">
            <a href="#" class="mobile-nav-link block py-3 px-4 text-gray-700 font-medium hover:bg-gray-100" data-category="all">Home</a>
            <a href="#" class="mobile-nav-link block py-3 px-4 text-gray-700 font-medium hover:bg-gray-100" data-category="sc">Supreme Court</a>
            <a href="#" class="mobile-nav-link block py-3 px-4 text-gray-700 font-medium hover:bg-gray-100" data-category="hc">High Courts</a>
            <a href="#" class="mobile-nav-link block py-3 px-4 text-gray-700 font-medium hover:bg-gray-100" data-category="columns">Columns</a>
            <a href="#" class="mobile-nav-link block py-3 px-4 text-gray-700 font-medium hover:bg-gray-100" data-category="interviews">Interviews</a>
        </div>
        <!-- Header Ad Slot -->
        <div class="container mx-auto px-4 pb-2">
            <div id="header-ad-container" class="ad-placeholder h-16 w-full"></div>
        </div>
    </header>

    <!-- MAIN CONTENT -->
    <main class="container mx-auto px-4 py-8">
        
        <!-- View for a single, full article (hidden by default) -->
        <div id="full-article-view" class="hidden">
            <button id="back-to-news-button" class="mb-6 bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg">‚Üê Back to News</button>
            <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                <img id="full-article-image" src="" alt="Full article image" class="w-full h-auto max-h-96 object-cover">
                <div class="p-6 md:p-8">
                    <h1 id="full-article-title" class="font-playfair text-3xl md:text-4xl font-bold text-gray-900 my-2 leading-tight"></h1>
                    <p id="full-article-meta" class="text-sm text-gray-500 mt-4 mb-6"></p>
                    <div id="full-article-content" class="prose lg:prose-xl max-w-none text-gray-700 leading-relaxed"></div>
                </div>
            </div>
        </div>

        <!-- Main container for all news lists (visible by default) -->
        <div id="all-news-view">
            <div class="mb-8">
                <div class="relative"><input type="text" id="search-input" placeholder="Search for stories..." class="w-full p-4 pl-12 text-lg bg-white border-2 border-gray-300 rounded-full focus:ring-blue-500 focus:border-blue-500"><i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i></div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-2">
                    <div id="news-content-area">
                        <!-- Sections will be dynamically populated here -->
                        <div id="sc-news-section" class="content-section mb-10"><h2 class="text-2xl font-bold text-gray-800 mb-4 border-b-2 border-red-700 pb-2">Supreme Court News</h2><div id="sc-news-container" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div></div>
                        <div id="hc-news-section" class="content-section mb-10"><h2 class="text-2xl font-bold text-gray-800 mb-4 border-b-2 border-blue-600 pb-2">High Court News</h2><div id="hc-news-container" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div></div>
                        <div id="columns-news-section" class="content-section mb-10"><h2 class="text-2xl font-bold text-gray-800 mb-4 border-b-2 border-green-700 pb-2">Columns</h2><div id="columns-container" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div></div>
                        <div id="interviews-news-section" class="content-section mb-10"><h2 class="text-2xl font-bold text-gray-800 mb-4 border-b-2 border-purple-700 pb-2">Interviews</h2><div id="interviews-container" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div></div>
                    </div>
                    <div id="no-results" class="hidden text-center py-16"><i class="fas fa-search text-4xl text-gray-400 mb-4"></i><h3 class="text-2xl font-semibold text-gray-700">No Stories Found</h3><p class="text-gray-500 mt-2">We couldn't find any articles matching your search.</p></div>
                </div>
                <!-- Sidebar Ad Slot -->
                <aside class="lg:col-span-1">
                    <div id="sidebar-ad-container" class="ad-placeholder h-64 w-full"></div>
                </aside>
            </div>
        </div>
    </main>

    <footer class="bg-gray-800 text-white mt-12"><div class="container mx-auto px-4 py-10"><div class="text-center text-gray-500 text-sm"><p>&copy; <span id="currentYear"></span> LawNews. All Rights Reserved.</p></div></div></footer>

    <script>
        document.addEventListener('DOMContentLoaded', async function () {
            // ===================================================================
            // SUPABASE SETUP
            // ===================================================================
            const SUPABASE_URL = 'https://vdoczcmcueiztpgqinww.supabase.co';
            const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZkb2N6Y21jdWVpenRwZ3Fpbnd3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ3MzI3MzAsImV4cCI6MjA3MDMwODczMH0.dSPZlduTFZMn6rusQbrzy51vAZ3oWS8ontAEmTgajQA';
            const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

            // --- Global State & UI Elements ---
            let allArticles = [];
            const allNewsView = document.getElementById('all-news-view');
            const fullArticleView = document.getElementById('full-article-view');
            const searchInput = document.getElementById('search-input');
            const noResultsView = document.getElementById('no-results');
            const newsContentArea = document.getElementById('news-content-area');
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');

            // --- SKELETON LOADER ---
            function createSkeletonCard() { return `<div class="skeleton bg-white rounded-lg shadow-md overflow-hidden"><div class="w-full h-48 bg-gray-300"></div><div class="p-4 space-y-3"><div class="h-4 bg-gray-300 rounded w-1/4"></div><div class="h-6 bg-gray-300 rounded w-full"></div><div class="h-4 bg-gray-300 rounded w-5/6"></div><div class="h-4 bg-gray-300 rounded w-3/4"></div></div></div>`; }
            function showSkeletons() {
                const containers = ['sc-news-container', 'hc-news-container', 'columns-container', 'interviews-container'];
                containers.forEach(id => { document.getElementById(id).innerHTML = createSkeletonCard().repeat(3); });
            }

            // --- DATA FETCHING & RENDERING ---
            async function fetchAllArticles() {
                showSkeletons();
                const { data, error } = await supabaseClient.from('articles').select('*').order('published_date', { ascending: false });
                if (error) { console.error('Error fetching articles:', error); return; }
                allArticles = data;
                renderAllSections();
            }

            function renderAllSections() {
                renderNews('supreme-court', 'sc-news-container', 3);
                renderNews('high-court', 'hc-news-container', 3);
                renderNews('columns', 'columns-container', 3);
                renderNews('interviews', 'interviews-container', 3);
            }

            function renderNews(category, containerId, limit) {
                const container = document.getElementById(containerId);
                const filteredArticles = allArticles.filter(article => article.category === category).slice(0, limit);
                if (!container) return;
                container.innerHTML = '';
                if (filteredArticles.length === 0) { container.innerHTML = '<p class="text-gray-500 md:col-span-2">No articles found in this category.</p>'; return; }
                filteredArticles.forEach(article => {
                    container.innerHTML += `<div class="bg-white rounded-lg shadow-md overflow-hidden news-card cursor-pointer" data-id="${article.id}"><img src="${article.image_url || 'https://placehold.co/600x400/E2E8F0/4A5568?text=Image'}" alt="${article.title}" class="article-image w-full h-48 object-cover"><div class="p-4 flex flex-col h-full"><h3 class="article-title font-semibold text-lg text-gray-800 my-1">${article.title}</h3><p class="article-summary text-gray-600 text-sm flex-grow">${article.summary}</p><p class="article-meta text-xs text-gray-500 mt-2">By ${article.author} | ${new Date(article.published_date).toLocaleDateString()}</p></div></div>`;
                });
            }

            // --- DYNAMIC AD FETCHING ---
            async function fetchAndDisplayAds() {
                const { data, error } = await supabaseClient.from('advertisements').select('ad_name, ad_code').eq('is_active', true);
                if (error) { console.error('Error fetching ads:', error); return; }
                data.forEach(ad => {
                    const adContainer = document.getElementById(`${ad.ad_name}-container`);
                    if (adContainer) {
                        adContainer.innerHTML = ad.ad_code;
                        adContainer.classList.remove('ad-placeholder');
                    }
                });
            }

            // --- VIEW & NAVIGATION LOGIC ---
            function showView(viewToShow) { allNewsView.classList.toggle('hidden', viewToShow !== 'all-news'); fullArticleView.classList.toggle('hidden', viewToShow !== 'full-article'); window.scrollTo(0, 0); }
            function filterContent(category) {
                showView('all-news');
                searchInput.value = '';
                noResultsView.classList.add('hidden');
                newsContentArea.classList.remove('hidden');
                document.querySelectorAll('.content-section').forEach(section => {
                    section.classList.toggle('hidden', category !== 'all' && section.id !== category + '-news-section');
                });
            }

            // --- EVENT LISTENERS ---
            // FIX: Added event listener for mobile menu button
            mobileMenuButton.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
            });

            // FIX: Added listeners for links inside the mobile menu
            document.querySelectorAll('.mobile-nav-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const category = e.target.dataset.category;
                    filterContent(category);
                    mobileMenu.classList.add('hidden'); // Hide menu after click
                });
            });

            document.getElementById('home-link').addEventListener('click', (e) => { e.preventDefault(); filterContent('all'); });
            document.getElementById('home-link-desktop').addEventListener('click', (e) => { e.preventDefault(); filterContent('all'); });
            document.getElementById('sc-link').addEventListener('click', (e) => { e.preventDefault(); filterContent('sc'); });
            document.getElementById('hc-link').addEventListener('click', (e) => { e.preventDefault(); filterContent('hc'); });
            document.getElementById('columns-link').addEventListener('click', (e) => { e.preventDefault(); filterContent('columns'); });
            document.getElementById('interviews-link').addEventListener('click', (e) => { e.preventDefault(); filterContent('interviews'); });
            document.getElementById('back-to-news-button').addEventListener('click', () => { showView('all-news'); filterContent('all'); });

            newsContentArea.addEventListener('click', function(e) {
                const card = e.target.closest('.news-card');
                if (card) {
                    e.preventDefault();
                    const articleId = parseInt(card.dataset.id);
                    const article = allArticles.find(a => a.id === articleId);

                    if (article) {
                        document.getElementById('full-article-image').src = article.image_url || 'https://placehold.co/800x450/E2E8F0/4A5568?text=Image';
                        document.getElementById('full-article-title').textContent = article.title;
                        document.getElementById('full-article-meta').textContent = `By ${article.author} | ${new Date(article.published_date).toLocaleDateString()}`;
                        document.getElementById('full-article-content').innerHTML = article.full_content.replace(/\n/g, '<br>');
                        showView('full-article');
                    }
                }
            });

            // --- SEARCH LOGIC WITH DEBOUNCING ---
            function debounce(func, delay) { let timeout; return function(...args) { clearTimeout(timeout); timeout = setTimeout(() => func.apply(this, args), delay); }; }
            const handleSearch = () => {
                const searchTerm = searchInput.value.toLowerCase();
                const searchResults = allArticles.filter(article => article.title.toLowerCase().includes(searchTerm) || article.summary.toLowerCase().includes(searchTerm));
                filterContent('all');
                const allContainers = document.querySelectorAll('[id$="-news-container"]');
                allContainers.forEach(c => c.innerHTML = '');
                if (searchResults.length === 0) { noResultsView.classList.remove('hidden'); newsContentArea.classList.add('hidden'); return; }
                renderNewsFromData(searchResults.filter(a => a.category === 'supreme-court'), 'sc-news-container');
                renderNewsFromData(searchResults.filter(a => a.category === 'high-court'), 'hc-news-container');
                renderNewsFromData(searchResults.filter(a => a.category === 'columns'), 'columns-container');
                renderNewsFromData(searchResults.filter(a => a.category === 'interviews'), 'interviews-container');
            };
            function renderNewsFromData(data, containerId) {
                const container = document.getElementById(containerId);
                if (!container) return;
                container.innerHTML = '';
                data.forEach(article => {
                    container.innerHTML += `<div class="bg-white rounded-lg shadow-md overflow-hidden news-card cursor-pointer" data-id="${article.id}"><img src="${article.image_url || 'https://placehold.co/600x400/E2E8F0/4A5568?text=Image'}" alt="${article.title}" class="article-image w-full h-48 object-cover"><div class="p-4 flex flex-col h-full"><h3 class="article-title font-semibold text-lg text-gray-800 my-1">${article.title}</h3><p class="article-summary text-gray-600 text-sm flex-grow">${article.summary}</p><p class="article-meta text-xs text-gray-500 mt-2">By ${article.author} | ${new Date(article.published_date).toLocaleDateString()}</p></div></div>`;
                });
            }
            searchInput.addEventListener('input', debounce(handleSearch, 300));

            // --- INITIAL LOAD ---
            fetchAllArticles();
            fetchAndDisplayAds();
        });
    </script>
</body>
</html>

